CREATE OR REPLACE PROCEDURE HYSOTELO.DISMINUYE_CANTIDAD_PRODUCTOS(PRODUCTO_ID NUMBER,CANTIDAD NUMBER, SALIDA OUT VARCHAR2)
IS
ID_REG_PROD NUMBER; --ESTABLECE EL ID DEL REGISTRO DEL PRODUCTO A BUSCAR
CANTIDAD_DISP NUMBER;
BEGIN
SALIDA := 'ERROR';
-- SE DEBE HACER LA CONSULTA DEL REGISTRO DEL PRODUCTO QUE    LLEGA POR PARMETRO
      SELECT COUNT(P.ID) INTO ID_REG_PROD
      FROM HYSOTELO.PRODUCTO P
      WHERE P.ID = PRODUCTO_ID AND P.ESTADO = 'A';
      
      IF ID_REG_PROD >0 THEN -- SI EXISTE EL REGISTRO SE CONSULTA LA CANTIDAD ACTUAL
        SELECT P.ID, P.CANTIDADES_DISPONIBLES INTO ID_REG_PROD, CANTIDAD_DISP 
        FROM HYSOTELO.PRODUCTO P
        WHERE P.ID = PRODUCTO_ID AND P.ESTADO = 'A';
        
        UPDATE HYSOTELO.PRODUCTO P
        SET P.CANTIDADES_DISPONIBLES = CANTIDAD_DISP - CANTIDAD
        WHERE P.ID = ID_REG_PROD;
        COMMIT;
        
        SALIDA := 'OK';
      ELSE
        SALIDA := 'ERROR, NO EXISTE EL REGISTRO DE PRODUCTO';
      END IF;
END DISMINUYE_CANTIDAD_PRODUCTOS;
